<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
</head>
<body>
  <script>
    const token = localStorage.getItem('token');
    if (!token) { window.location.href = '/login'; }

    async function loadData() {
      const res = await fetch('/api/dashboard-data', {
        headers: { 'Authorization': 'Bearer ' + token }
      });
      const data = await res.json();
      document.getElementById('welcome').innerText =
          'Welcome, ' + data.user;
      const list = document.getElementById('fileList');
      list.innerHTML = data.files.map(f =>
        `<li><a href="/uploads/${f}" target="_blank">${f}</a></li>`
      ).join('');
    }

    async function uploadFile(e) {
      e.preventDefault();
      const fileField = document.getElementById('file');
      const formData  = new FormData();
      formData.append('file', fileField.files[0]);

      const res = await fetch('/upload', {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + token },
        body: formData
      });
      const data = await res.json();
      alert(data.message);
      if (res.ok) { loadData(); document.getElementById('file').value = ''; }
    }

    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/login';
    }

    window.onload = loadData;
  </script>

  <h2 id="welcome">Loading â€¦</h2>

  <h3>Upload new config file</h3>
  <form id="uploadForm" onsubmit="uploadFile(event)">
    <input type="file" id="file" required>
    <button type="submit">Upload</button>
  </form>

  <h3>Files:</h3>
  <ul id="fileList"></ul>

  <button onclick="logout()">Logout</button>
</body>
</html>
